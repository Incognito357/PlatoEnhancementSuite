function SaveSetting(){var e={sessionmonitor:{enabled:chkbox_sessionmonitor.checked},chatter:{enabled:chkbox_chatter.checked}};settings.set({enabled_modules:e}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"toggle_module"},function(e){update_loaded_modules()})})}function update_loaded_modules(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{action:"get_loaded_modules"},function(e){$("#modules div div.is_module_loaded").each(function(o,d){$(d).removeClass("is_loaded not_loaded").addClass(e.module_info[o].is_loaded?"is_loaded":"not_loaded")})})})}var chkbox_sessionmonitor=$("#chkbox_enable_sessionmonitor")[0],chkbox_chatter=$("#chkbox_enable_chatter")[0],settings=chrome.storage.local;chkbox_sessionmonitor.addEventListener("change",SaveSetting),chkbox_chatter.addEventListener("change",SaveSetting),settings.get("enabled_modules",function(e){chkbox_sessionmonitor.checked=e.enabled_modules.sessionmonitor.enabled,chkbox_chatter.checked=e.enabled_modules.chatter.enabled}),$("#modules div").on("click",function(e){e.stopPropagation();var o=$(this).find("div.settings");o.hasClass("closed")?o.removeClass("closed"):o.addClass("closed")}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){return e[0].url.indexOf("https://learn.pct.edu")<0?($("h2").text("Please navigate to Plato to begin using PES"),void $("#modules").remove()):(chrome.tabs.sendMessage(e[0].id,{action:"get_app_version"},function(e){void 0!=e&&$("#app_version").text("v"+e)}),void chrome.tabs.sendMessage(e[0].id,{action:"get_loaded_modules"},function(e){$("#modules div div.is_module_loaded").each(function(o,d){$(d).addClass(e.module_info[o].is_loaded?"is_loaded":"not_loaded")})}))}),chrome.runtime.onMessage.addListener(function(e,o,d){"update_popup_from_module"==e.action&&update_loaded_modules()});