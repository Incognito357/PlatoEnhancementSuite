var Chatter=function(){this.VERSION="1.0.0",this.loaded=!1,this.settings=chrome.storage.local,this.enabled;var e=!1;this.updateloop,this.user_count=0,this.colors=["YellowGreen","DarkGoldenRod","Chocolate","LimeGreen","CornflowerBlue","Violet","LightSkyBlue","SaddleBrown","DarkOrange","SeaGreen","MediumVioletRed","DarkTurquoise","Olive","Tomato","DarkOliveGreen","Turquoise","DarkRed","Purple","Maroon","RebeccaPurple","DarkCyan","MediumBlue","HotPink","DeepPink","CadetBlue","PaleVioletRed","DarkOrchid","MediumPurple","Brown","DeepSkyBlue","DodgerBlue","SlateBlue","OliveDrab","OrangeRed","Coral","Crimson","Red","LightCoral","FireBrick","LightSeaGreen","MediumSlateBlue","DarkMagenta","Teal","Orchid","MidnightBlue","Orange","MediumAquaMarine","Green","DarkSalmon","DarkBlue","Navy","SteelBlue","Fuchsia","SkyBlue","ForestGreen","MediumSeaGreen","DarkViolet","RosyBrown","DarkSlateBlue","DarkSeaGreen","RoyalBlue","DarkGreen","MediumOrchid","BlueViolet"],this.color_map={},this.iframe,this.userlist,this.msglist,this.msgbox,this.btnsend,this.chkEnterToSend;var t=this;this.start=function(){t.checkEnabled(),setTimeout(function(){t.setup(),e=!0},5e3),chrome.runtime.onMessage.addListener(function(e,n,o){"toggle_module"==e.action&&(t.checkEnabled(),o("checkEnabled"))})},this.setup=function(){t.enabled&&(t.iframe=$("iframe").contents(),t.userlist=t.iframe.find("#userlst_id"),t.msglist=t.iframe.find("#msglst_id"),t.msgbox=t.iframe.find("#d2l_form textarea"),t.btnsend=t.iframe.find("#d2l_form a[id*=z_]"),0==t.userlist.length&&0==t.msglist.length&&(t.userlist=$("#userlst_id"),t.msglist=$("#msglst_id"),t.msgbox=$("#d2l_form textarea"),t.btnsend=$("#d2l_form a[id*=z_]"),0==t.userlist.length&&0==t.msglist.length)||(t.btnsend.wrap("<div style='display:inline-block;'></div>"),t.chkEnterToSend=$("<input type='checkbox' name='enter_to_send' id='enter_to_send' />").insertAfter(t.btnsend),$("<label for='enter_to_send'>Enter to Send</label>").insertAfter(t.chkEnterToSend),$("</br>").insertAfter(t.btnsend),t.msgbox.on("keyup",function(e){13==e.which&&1==t.chkEnterToSend.prop("checked")&&t.btnsend[0].click()}),t.userlist.find("li").each(function(e,n){var o=$(n).text(),r=t.colors[t.user_count];t.color_map[o]=r,t.user_count++}),t.userlist.find("li span").each(function(e,n){var o=$(n).text();$(n).prop("style","color:"+t.color_map[o])}),t.msglist.find("div").each(function(e,t){$(t).prop("style","white-space:normal;background-color:#EFEFEF;margin:5px 0;padding:5px;border-radius:10px;")}),t.msglist.find("h3 span").each(function(e,n){var o=$(n).text().replace(":","");$(n).prop("style","font-weight:bold;color:"+t.color_map[o])}),t.userlist.on("contentChanged",t.pollUsers),t.msglist.on("contentChanged",t.pollMessages),t.loaded=!0,t.update()))};var n,o;this.update=function(){r.log("Plato Enhancement Suite: Chatter has started!"),chrome.runtime.sendMessage({action:"update_popup_from_module"},null),t.updateloop=setInterval(function(){var e=t.userlist,r=t.msglist.children().length;n!==e.html()&&(n=e.html(),t.userlist.trigger("contentChanged")),o!==r&&(o=r,t.msglist.trigger("contentChanged"))},10)},this.pollUsers=function(){t.userlist.find("li").each(function(e,n){var o=$(n).text();if(!(o in t.color_map)){var r=t.colors[t.user_count];t.color_map[o]=r}$(n).find("span").prop("style","color:"+t.color_map[o])})},this.pollMessages=function(){t.msglist.find("div").each(function(e,t){$(t).prop("style","white-space:normal;background-color:#ECECEC;margin:5px 0;padding:5px;border-radius:10px;")}),t.msglist.find("h3 span").each(function(e,n){var o=$(n).text().replace(":","");$(n).prop("style","font-weight:bold;color:"+t.color_map[o])})},this.checkEnabled=function(){t.settings.get("enabled_modules",function(n){var o;o=void 0==n.enabled_modules||n.enabled_modules.chatter.enabled,t.enabled!=o&&(t.enabled=o,t.enabled?e&&(t.loaded?t.update():t.setup()):(clearInterval(t.updateloop),r.log("Plato Enhancement Suite: Chatter is not running!")))})},this.info=function(){return{name:"Chatter",version:t.VERSION,is_loaded:t.loaded&&t.enabled}},this.dev=function(e){dev=e};var r={log:function(e){dev&&console.log(e)}}},c=new Chatter;module.exports.start=c.start,module.exports.getInfo=c.info,module.exports.dev=c.dev;